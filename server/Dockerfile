FROM node:lts

# Set arguments
ARG _DIR_NAME
ARG _MYSQL_DB_HOST
ARG _MYSQL_DB_DATABASE
ARG _MYSQL_DB_USER
ARG _MYSQL_DB_PASS
ARG _MYSQL_DB_TABLE
ARG _POSTGRESQL_DB_HOST
ARG _POSTGRESQL_DB_DATABASE
ARG _POSTGRESQL_DB_USER
ARG _POSTGRESQL_DB_PASS
ARG _POSTGRESQL_DB_TABLE

# Set environment variables
ENV MYSQL_DB_HOST=$_MYSQL_DB_HOST
ENV MYSQL_DB_DATABASE=$_MYSQL_DB_DATABASE
ENV MYSQL_DB_USER=$_MYSQL_DB_USER
ENV MYSQL_DB_PASS=$_MYSQL_DB_PASS
ENV MYSQL_DB_TABLE=$_MYSQL_DB_TABLE
ENV POSTGRESQL_DB_HOST=$_POSTGRESQL_DB_HOST
ENV POSTGRESQL_DB_DATABASE=$_POSTGRESQL_DB_DATABASE
ENV POSTGRESQL_DB_USER=$_POSTGRESQL_DB_USER
ENV POSTGRESQL_DB_PASS=$_POSTGRESQL_DB_PASS
ENV POSTGRESQL_DB_TABLE=$_POSTGRESQL_DB_TABLE

WORKDIR /usr/src/app

COPY ./$_DIR_NAME/package*.json ./

RUN npm install

COPY ./$_DIR_NAME .

RUN npm run build

CMD ["npm","run","start"]